---
// Lógica del Servidor (Backend)
import { db, Turnos } from 'astro:db';

// Si el método es POST (alguien envió el formulario)
if (Astro.request.method === 'POST') {
  // 1. Obtener los datos del formulario
  const formData = await Astro.request.formData();
  const nombre = formData.get('nombre') as string;
  const apellido = formData.get('apellido') as string;
  const fecha = formData.get('fecha') as string;
  const hora = formData.get('hora') as string;
  const telefono = formData.get('telefono') as string;

  // 2. Insertar en la Base de Datos
  try {
    await db.insert(Turnos).values({
      nombre,
      apellido,
      fecha,
      hora,
      telefono
    });
    console.log("Turno guardado con éxito");
    // Aquí podríamos redirigir a una página de "Gracias"
  } catch (error) {
    console.error("Error al guardar turno:", error);
  }
}
---

<section id="booking" class="booking-section section-padding">
    <div class="container">
        <h2>AGENDA TU TURNO</h2>
        <p class="subtitle">La excelencia requiere tiempo. Reserva tu espacio exclusivo.</p>
        
        <div class="booking-container">
            <form method="POST" class="booking-form">
                <div class="form-group">
                    <input type="text" name="nombre" placeholder="Nombre" required>
                    <input type="text" name="apellido" placeholder="Apellido" required>
                </div>
                
                <div class="form-group">
                    <input type="tel" name="telefono" placeholder="Teléfono / WhatsApp">
                </div>

                <div class="form-group">
                    <input type="date" name="fecha" required>
                    <select name="hora" required>
                        <option value="" disabled selected>Selecciona una hora</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-submit">CONFIRMAR RESERVA</button>
            </form>
        </div>
    </div>
</section>

<style>
    .booking-section {
        background-color: var(--color-text-black);
        color: var(--color-bg-beige);
        text-align: center;
    }

    h2 {
        font-size: 3rem;
        margin-bottom: 10px;
        color: var(--color-bg-beige);
    }

    .subtitle {
        font-size: 1.1rem;
        opacity: 0.8;
        margin-bottom: 40px;
    }
    
    .booking-container {
        max-width: 600px;
        margin: 0 auto;
        background-color: rgba(255,255,255, 0.05);
        padding: 40px;
        border-radius: 8px;
        border: 1px solid rgba(242, 240, 230, 0.1);
    }

    .form-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }

    /* Input Styles */
    input, select {
        width: 100%;
        padding: 15px;
        background-color: transparent;
        border: 1px solid rgba(242, 240, 230, 0.3);
        color: var(--color-bg-beige);
        font-family: var(--font-body);
        font-size: 1rem;
        border-radius: 4px;
        outline: none;
    }

    input:focus, select:focus {
        border-color: var(--color-bg-beige);
        background-color: rgba(255,255,255, 0.05);
    }

    /* Hack para el calendario en navegadores oscuros */
    input[type="date"] {
        color-scheme: dark;
    }

    select option {
        background-color: #333;
        color: #fff;
    }

    .btn-submit {
        width: 100%;
        margin-top: 10px;
        background-color: var(--color-bg-beige);
        color: var(--color-text-black);
        border: none;
        font-weight: 700;
    }

    .btn-submit:hover {
        background-color: #fff;
        transform: scale(1.02);
    }

    @media (max-width: 768px) {
        .form-group {
            flex-direction: column;
            gap: 20px;
        }
    }
</style>